
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Quick Start &#8212; bobaos  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Introduction" href="intro.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="quick-start">
<span id="quick-start"></span><h1>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<div class="section" id="hardware-configuration">
<span id="hardware-configuration"></span><h2>hardware configuration<a class="headerlink" href="#hardware-configuration" title="Permalink to this headline">¶</a></h2>
<p>Assuming that Raspberry Pi 3 is used.</p>
<p>The Raspberry Pi 3 does not use the correct baud rate in Raspian out of the box, so kBerry will not work. To fix this, the overlay pi3-miniuart-bt-overlay must be activated.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo sh -c &quot;echo dtoverlay=pi3-miniuart-bt &gt;&gt;/boot/config.txt&quot;
</pre></div>
</div>
<p>Open /boot/cmdline.txt and remove console=ttyAMA0,115200 from the file For Raspbian Jessie and newer the entry is console=serial0,115200</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo nano /boot/cmdline.txt
</pre></div>
</div>
<p>Make sure the user has the rights to access the ttyAMA0</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Check the group of the device
ls -l /dev/ttyAMA0
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>crw-rw---- 1 root dialout 204, 64 Aug  4 11:33 /dev/ttyAMA0
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Add the user to the group seen above
sudo usermod -a -G dialout pi
</pre></div>
</div>
<p>After reboot proceed to next steps.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo reboot
</pre></div>
</div>
</div>
<div class="section" id="node-js">
<span id="node-js"></span><h2>Node.js<a class="headerlink" href="#node-js" title="Permalink to this headline">¶</a></h2>
<p>Install <a class="reference external" href="https://nodejs.org">nodejs</a></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -
sudo apt-get install -y nodejs
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/nodesource/distributions/blob/master/README.md">More info</a></p>
</div>
<div class="section" id="redis">
<span id="redis"></span><h2>Redis<a class="headerlink" href="#redis" title="Permalink to this headline">¶</a></h2>
<p>bobaos.pub broadcasts events over publish/subscribe and uses queues backed by <a class="reference external" href="https://redis.io/">Redis</a>. So, install it at first and start service.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo apt install redis-server
sudo systemctl daemon-reload
sudo systemctl enable redis.service
sudo systemctl start redis.service
</pre></div>
</div>
<p>Check with <code class="docutils literal notranslate"><span class="pre">redis-cli</span></code> if it is running. If not, reboot and try testing with <code class="docutils literal notranslate"><span class="pre">redis-cli</span></code> again.</p>
</div>
<div class="section" id="bobaos-pub">
<span id="bobaos-pub"></span><h2>bobaos.pub<a class="headerlink" href="#bobaos-pub" title="Permalink to this headline">¶</a></h2>
<p>Now, let install working service for BAOS sdk.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo npm i -g bobaos.pub --unsafe-perm
</pre></div>
</div>
<p>After that, edit config file located at <strong>/usr/lib/node_modules/bobaos.pub/config.json</strong> and replace default <strong>/dev/ttyS1</strong> to <strong>/dev/ttyAMA0</strong>.</p>
<p>Create service file for systemd:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo nano /etc/systemd/system/bobaos_pub.service
</pre></div>
</div>
<p>Use following content for this file:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[Unit]
Description=PubSub service running on nodejs
After=redis.service

[Service]
User=pi
ExecStart=/usr/bin/env bobaos-pub
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
</pre></div>
</div>
<p>Reload systemd daemon, enable and start service.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo systemctl daemon-reload
sudo systemctl enable bobaos_pub.service
sudo systemctl start bobaos_pub.service
</pre></div>
</div>
<p>Proceed to final steps.</p>
</div>
<div class="section" id="bobaos-tool">
<span id="bobaos-tool"></span><h2>bobaos.tool<a class="headerlink" href="#bobaos-tool" title="Permalink to this headline">¶</a></h2>
<p>To control datapoint values from shell, bobaos.tool package is used.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo npm i -g bobaos.tool
</pre></div>
</div>
<p>Run and ping sdk:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>~$ bobaos-tool
hello, friend
connecting to /var/run/myps/myipc.sock
connected to ipc, still not subscribed to channels
ready to send requests
bobaos&gt; help
:: To work with datapoints
::  set ( 1: true | [2: &quot;hello&quot;, 3: 42] )
::&gt; get ( 1 2 3 | [1, 2, 3] )
::  stored ( 1 2 3 | [1, 2, 3] )
::&gt; read ( 1 2 3 | [1, 2, 3] )
::  description ( * | 1 2 3 | [1, 2, 3] )

:: Helpful in bus monitoring:
::&gt; watch ( 1: red | [1: red, 2: green, 3: underline] )
::  unwatch ( 1 2 3 | [1, 2, 3] )

:: BAOS services:
::&gt; getbyte ( 1 2 3 | [1, 2, 3] )
::  getitem ( * | 1 2 ..17 | [1, 2, ..17] )
::&gt; progmode ( ? | true/false/1/0 )

:: General:
::&gt; ping
::  state
::&gt; reset
::  help
bobaos&gt; ping
ping: true
bobaos&gt;
</pre></div>
</div>
<p>Some command examples:</p>
<ul class="simple">
<li>Programming mode</li>
</ul>
<p>First <strong>cool feature</strong>: there is no need to press programming button.</p>
<p>To get/set programming mode following command is used:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; progmode ?
BAOS module in programming mode: false
bobaos&gt; progmode 1
BAOS module in programming mode: true
bobaos&gt; progmode 0
BAOS module in programming mode: false
bobaos&gt; progmode true
BAOS module in programming mode: true
bobaos&gt; progmode false
BAOS module in programming mode: false
bobaos&gt;
</pre></div>
</div>
<ul class="simple">
<li>Get description for datapoints:</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; description 1 2 3
#1: length = 2, dpt = dpt9,  prio: low  flags: [C-WTU]
#2: length = 1, dpt = dpt5,  prio: low  flags: [C-WTU]
#3: length = 1, dpt = dpt5,  prio: low  flags: [C-WTU]
bobaos&gt;
</pre></div>
</div>
<p>To list all datapoints, run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; description *
</pre></div>
</div>
<ul class="simple">
<li>Set value:</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; set 2: 0
20:27:06:239,    id: 2, value: 0, raw: [0]
bobaos&gt; set [2: 0, 3: 128, 999: &quot;hello, friend&quot;]
20:28:48:586,    id: 2, value: 0, raw: [0]
20:28:48:592,    id: 3, value: 128, raw: [128]
20:28:48:593,    id: 999, value: &quot;hello, friend, raw: [34,104,101,108,108,111,44,32,102,114,105,101,110,100]
</pre></div>
</div>
<p>I would advice to use <strong>multiple value sending</strong> as a cool feature of BAOS protocol.</p>
<ul class="simple">
<li>Get values:</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; get 1 2 3 4 5 101 102 103
20:38:02:250,    id: 1, value: 23, raw: [12,126]
20:38:02:260,    id: 2, value: 0, raw: [0]
20:38:02:268,    id: 3, value: 128, raw: [128]
20:38:02:277,    id: 4, value: 0, raw: [0]
20:38:02:286,    id: 5, value: 0, raw: [0]
20:38:02:295,    id: 101, value: false, raw: [0]
20:38:02:304,    id: 102, value: false, raw: [0]
20:38:02:312,    id: 103, value: false, raw: [0]
</pre></div>
</div>
<p>It is possible to get value stored in RPi’s RAM:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; stored  1 2 3
20:39:54:963,    id: 1, value: 22.9, raw: [12,121]
20:39:54:974,    id: 2, value: 0, raw: [0]
20:39:54:982,    id: 3, value: 128, raw: [128]
</pre></div>
</div>
<p>This feature can help to get datapoint values and don’t send a lot of requests over UART.</p>
<ul class="simple">
<li>Read values:</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; read 1 2 3 105
20:42:12:540,    id: 1, value: 22.9, raw: [12,121]
20:42:12:642,    id: 105, value: false, raw: [0]
bobaos&gt;
</pre></div>
</div>
<p>In this example only two datapoint indications came from bus. That happened because there is no KNX objects configured with flag <strong>Read</strong> for datapoints 2 and 3(these are control). Datapoint 1 is a temperature sensor and datapoint 105 is binary output feedback.</p>
<p>If group objects configured right, but there is no read response, check update flag in BAOS ETS config.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; description 1 2 3 105
#1: length = 2, dpt = dpt9,  prio: low  flags: [C-WTU]
#2: length = 1, dpt = dpt5,  prio: low  flags: [C-WTU]
#3: length = 1, dpt = dpt5,  prio: low  flags: [C-WTU]
#105: length = 1, dpt = dpt1,  prio: low  flags: [C-WTU]
bobaos&gt;
</pre></div>
</div>
<p>In this example, <strong>U</strong> flag assigned for all of these objects.</p>
<ul class="simple">
<li>Monitoring datapoint values with colors:</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; watch 1: green
datapoint 1 value is now in green
bobaos&gt; watch [1: green, 105: underline]
datapoint 1 value is now in green
datapoint 105 value is now in underline
bobaos&gt; read 1 105
20:50:18:077,    id: 1, value: 22.9, raw: [12,121]
20:50:18:123,    id: 105, value: false, raw: [0]
bobaos&gt; unwatch 1 105
datapoint 1 value is now in default color
datapoint 105 value is now in default color
bobaos&gt; read 1 105
20:50:41:901,    id: 1, value: 23, raw: [12,126]
20:50:41:944,    id: 105, value: false, raw: [0]
bobaos&gt;
</pre></div>
</div>
<p>This feature is helpful when there is a need to catch by eyes certain datapoints from common output.</p>
<ul class="simple">
<li>Other BAOS services: server items, parameter bytes</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; getitem *
[ { id: &#39;1&#39;, value: [ 0, 0, 197, 8, 0, 3 ], raw: &#39;AADFCAAD&#39; },
  { id: &#39;2&#39;, value: [ 16 ], raw: &#39;EA==&#39; },
  { id: &#39;3&#39;, value: [ 18 ], raw: &#39;Eg==&#39; },
  { id: &#39;4&#39;, value: [ 0, 197 ], raw: &#39;AMU=&#39; },
  { id: &#39;5&#39;, value: [ 0, 197 ], raw: &#39;AMU=&#39; },
  { id: &#39;6&#39;, value: [ 8, 5 ], raw: &#39;CAU=&#39; },
  { id: &#39;7&#39;, value: [ 16 ], raw: &#39;EA==&#39; },
  { id: &#39;8&#39;, value: [ 0, 197, 1, 1, 118, 183 ], raw: &#39;AMUBAXa3&#39; },
  { id: &#39;9&#39;, value: [ 42, 39, 107, 116 ], raw: &#39;KidrdA==&#39; },
  { id: &#39;10&#39;, value: [ 1 ], raw: &#39;AQ==&#39; },
  { id: &#39;11&#39;, value: [ 0, 250 ], raw: &#39;APo=&#39; },
  { id: &#39;12&#39;, value: [ 0, 0 ], raw: &#39;AAA=&#39; },
  { id: &#39;13&#39;, value: [ 1 ], raw: &#39;AQ==&#39; },
  { id: &#39;14&#39;, value: [ 0, 250 ], raw: &#39;APo=&#39; },
  { id: &#39;15&#39;, value: [ 0 ], raw: &#39;AA==&#39; },
  { id: &#39;16&#39;, value: [ 32 ], raw: &#39;IA==&#39; },
  { id: &#39;17&#39;, value: [ 1 ], raw: &#39;AQ==&#39; } ]
bobaos&gt;
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; getbyte 1 2 3
[ 1, 3, 5 ]
bobaos&gt;
</pre></div>
</div>
<p>To get parameter byte values.</p>
<ul class="simple">
<li>General commands: <strong>ping, state, reset</strong></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bobaos&gt; ping
ping: true
bobaos&gt; state
get sdk state: ready
bobaos&gt; reset
reset request sent
bobaos&gt; state
get sdk state: ready
bobaos&gt;
</pre></div>
</div>
</div>
<div class="section" id="bobaos-sub">
<span id="bobaos-sub"></span><h2>bobaos.sub<a class="headerlink" href="#bobaos-sub" title="Permalink to this headline">¶</a></h2>
<p>This library control BAOS datapoints from nodejs app.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>npm i --save bobaos.sub
</pre></div>
</div>
<p>Then in script:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">BobaosSub</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bobaos.sub&#39;</span><span class="p">);</span>
 
<span class="kd">let</span> <span class="nx">my</span> <span class="o">=</span> <span class="nx">BobaosSub</span><span class="p">();</span>
 
<span class="nx">my</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;connected to ipc, still not subscribed to channels&quot;</span><span class="p">);</span>
<span class="p">});</span>
 
<span class="nx">my</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;ready&quot;</span><span class="p">,</span> <span class="nx">async</span> <span class="nx">_</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello, friend&quot;</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ping:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ping</span><span class="p">());</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;get sdk state:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getSdkState</span><span class="p">());</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;get value:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getValue</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">106</span><span class="p">]));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;get stored value:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getValue</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">106</span><span class="p">]));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;get server item:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getServerItem</span><span class="p">(</span><span class="s2">&quot;SerialNumber&quot;</span><span class="p">));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;set value:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">setValue</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="mi">103</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mi">0</span><span class="p">}));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;read value:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">readValue</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">]));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;get programming mode:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getProgrammingMode</span><span class="p">());</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;set programming mode:&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">setProgrammingMode</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;get parameter byte&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getParameterByte</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">my</span><span class="p">.</span><span class="nx">reset</span><span class="p">());</span>
  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;err&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
 
<span class="nx">my</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;datapoint value&quot;</span><span class="p">,</span> <span class="nx">payload</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;broadcasted datapoint value: &quot;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
<span class="p">});</span>
 
<span class="nx">my</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;server item&quot;</span><span class="p">,</span> <span class="nx">payload</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;broadcasted server item: &quot;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
<span class="p">});</span>
 
<span class="nx">my</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;sdk state&quot;</span><span class="p">,</span> <span class="nx">payload</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;broadcasted sdk state: &quot;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="bobaos-ws">
<span id="bobaos-ws"></span><h2>bobaos.ws<a class="headerlink" href="#bobaos-ws" title="Permalink to this headline">¶</a></h2>
<p>This package is used to add WebSocket support</p>
<div class="section" id="installation">
<span id="installation"></span><h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo npm i -g bobaos.ws
</pre></div>
</div>
<p>You can run it:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>pi@pi:~$ bobaos-ws
Starting bobaos.ws
bobaos sdk: ready
</pre></div>
</div>
<p>Try to send from any websocket client following request on port 49190</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;ping&quot;</span><span class="p">,</span> <span class="nt">&quot;payload&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">}</span>
</pre></div>
</div>
<p>If everything is ok, create service file `/etc/systemd/system/bobaos_ws.service:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[Unit]
Description=WebSocket server for bobaos.pub
After=bobaos_pub.service

[Service]
User=pi
ExecStart=/usr/bin/env bobaos-ws
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
</pre></div>
</div>
<p>Reload systemd, start and enable daemon:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo systemctl daemon-reload
sudo systemctl start bobaos_ws.service
sudo systemctl enable bobaos_ws.service
</pre></div>
</div>
<p>After that, to configure <code class="docutils literal notranslate"><span class="pre">bobaos.ws</span></code> edit <code class="docutils literal notranslate"><span class="pre">/usr/lib/node_modules/bobaos.ws/config.json</span></code> file.</p>
</div>
<div class="section" id="protocol">
<span id="protocol"></span><h3>Protocol<a class="headerlink" href="#protocol" title="Permalink to this headline">¶</a></h3>
<div class="section" id="overview">
<span id="overview"></span><h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>Published messages to websocket are serialized JSON objects, containing required fields <code class="docutils literal notranslate"><span class="pre">request_id,</span> <span class="pre">method,</span> <span class="pre">payload</span></code>.
For broadcasted messages <code class="docutils literal notranslate"><span class="pre">request_id</span></code> field is not used.</p>
<p>For outgoing requests:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">request_id</span></code> is used to receive response exactly to this request. If it is not defined then you will not receive response from server.</li>
<li><code class="docutils literal notranslate"><span class="pre">method</span></code> is an API method.</li>
<li><code class="docutils literal notranslate"><span class="pre">payload</span></code> depends on method. It may be datapoint id, array of ids, value, or null.</li>
</ul>
<p>Request:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="mi">420</span><span class="p">,</span>
  <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;get parameter byte&quot;</span><span class="p">,</span>
  <span class="nt">&quot;payload&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;response_id&quot;</span><span class="p">:</span><span class="mi">420</span><span class="p">,</span>
  <span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
  <span class="nt">&quot;payload&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="api-methods">
<span id="api-methods"></span><h4>API methods<a class="headerlink" href="#api-methods" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">ping</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">true/false</span></code> depending on running state of bobaos.pub service.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">sdk</span> <span class="pre">state</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<p>Check if connected to BAOS.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">reset</span></code>.</p>
<p>Restart SDK. Reload datapoints/server items.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">description</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">null/id/[id1,</span> <span class="pre">..</span> <span class="pre">idN]</span></code>.</p>
<p>Get description for datapoints with given ids. If payload is null then description for all datapoints will be returned.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">value</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">id/[id1,</span> <span class="pre">..</span> <span class="pre">idN]</span></code>.</p>
<p>Get value for datapoints with given ids.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">stored</span> <span class="pre">value</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">id/[id1,</span> <span class="pre">..</span> <span class="pre">idN]</span></code>.</p>
<p>Get value stored in bobaos.pub service. Do not send any data via UART.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">value</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">{id:</span> <span class="pre">i,</span> <span class="pre">value:</span> <span class="pre">v}/[{id:</span> <span class="pre">i1,</span> <span class="pre">value:</span> <span class="pre">v1},</span> <span class="pre">..</span> <span class="pre">{id:</span> <span class="pre">iN,</span> <span class="pre">value:</span> <span class="pre">vN}]</span></code></p>
<p>Set datapoints value and send to bus. Keep in mind that after successful request, new datapoint value will be broadcasted to all websocket clients, including sender.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">read</span> <span class="pre">value</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">id/[id1,</span> <span class="pre">..</span> <span class="pre">idN]</span></code>.</p>
<p>Send read requests to KNX bus. Keep in mind that datapoint object should have active Update flag.
If reading was successful then datapoint value will be broadcasted.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">server</span> <span class="pre">item</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">null/id/[id1,</span> <span class="pre">..</span> <span class="pre">idN]</span></code>.</p>
<p>Get server items with given id/ids. To get all server items use <code class="docutils literal notranslate"><span class="pre">null</span></code> as a payload.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">programming</span> <span class="pre">mode</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">1/0/true/false</span></code>.</p>
<p>Send to BAOS request to go into programming mode.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">programming</span> <span class="pre">mode</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<p>Return current value of ProgrammingMode sever item.</p>
</li>
<li><p class="first">Method: <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">parameter</span> <span class="pre">byte</span></code>. Payload: <code class="docutils literal notranslate"><span class="pre">id/[id1,</span> <span class="pre">..</span> <span class="pre">idN]</span></code>.</p>
<p>Get parameter byte values for given ids.</p>
</li>
</ul>
</div>
<div class="section" id="communication-example">
<span id="communication-example"></span><h4>Communication example<a class="headerlink" href="#communication-example" title="Permalink to this headline">¶</a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;ping&quot;, &quot;payload&quot;: null}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:true}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;get sdk state&quot;, &quot;payload&quot;: null}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:&quot;ready&quot;}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;reset&quot;, &quot;payload&quot;: null}
{&quot;method&quot;:&quot;sdk state&quot;,&quot;payload&quot;:&quot;stop&quot;}
{&quot;method&quot;:&quot;sdk state&quot;,&quot;payload&quot;:&quot;ready&quot;}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:null}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:1,&quot;value&quot;:23.6,&quot;raw&quot;:&quot;DJw=&quot;}}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;get description&quot;, &quot;payload&quot;: 1}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:{&quot;valid&quot;:&quot;true&quot;,&quot;id&quot;:&quot;1&quot;,&quot;length&quot;:&quot;2&quot;,&quot;dpt&quot;:&quot;dpt9&quot;,&quot;flag_priority&quot;:&quot;low&quot;,&quot;flag_communication&quot;:&quot;true&quot;,&quot;flag_read&quot;:&quot;false&quot;,&quot;flag_write&quot;:&quot;true&quot;,&quot;false&quot;:&quot;false&quot;,&quot;flag_readOnInit&quot;:&quot;false&quot;,&quot;flag_update&quot;:&quot;true&quot;,&quot;flag_transmit&quot;:&quot;true&quot;,&quot;value&quot;:&quot;23.6&quot;,&quot;raw&quot;:&quot;DJw=&quot;}}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;get value&quot;, &quot;payload&quot;: 1}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:{&quot;id&quot;:1,&quot;value&quot;:23.6,&quot;raw&quot;:&quot;DJw=&quot;}}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:1,&quot;value&quot;:23.6,&quot;raw&quot;:&quot;DJw=&quot;}}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;get stored value&quot;, &quot;payload&quot;: 1}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:{&quot;id&quot;:1,&quot;value&quot;:23.6,&quot;raw&quot;:&quot;DJw=&quot;}}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;set value&quot;, &quot;payload&quot;: {&quot;id&quot;: 103, &quot;value&quot;: false}}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:[{&quot;id&quot;:103,&quot;value&quot;:false,&quot;raw&quot;:&quot;AA==&quot;}]}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:[{&quot;id&quot;:103,&quot;value&quot;:false,&quot;raw&quot;:&quot;AA==&quot;}]}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:107,&quot;value&quot;:false,&quot;raw&quot;:&quot;AA==&quot;}}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:1,&quot;value&quot;:23.6,&quot;raw&quot;:&quot;DJw=&quot;}}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;set value&quot;, &quot;payload&quot;: [{&quot;id&quot;: 102, &quot;value&quot;: true}, {&quot;id&quot;: 103, &quot;value&quot;: true}]}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:[{&quot;id&quot;:102,&quot;value&quot;:true,&quot;raw&quot;:&quot;AQ==&quot;},{&quot;id&quot;:103,&quot;value&quot;:true,&quot;raw&quot;:&quot;AQ==&quot;}]}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:[{&quot;id&quot;:102,&quot;value&quot;:true,&quot;raw&quot;:&quot;AQ==&quot;},{&quot;id&quot;:103,&quot;value&quot;:true,&quot;raw&quot;:&quot;AQ==&quot;}]}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:107,&quot;value&quot;:true,&quot;raw&quot;:&quot;AQ==&quot;}}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;read value&quot;, &quot;payload&quot;: [1, 105, 106]}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:null}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:1,&quot;value&quot;:22.7,&quot;raw&quot;:&quot;DG8=&quot;}}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:105,&quot;value&quot;:false,&quot;raw&quot;:&quot;AA==&quot;}}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:106,&quot;value&quot;:true,&quot;raw&quot;:&quot;AQ==&quot;}}
{&quot;request_id&quot;: 42, &quot;method&quot;: &quot;get server item&quot;, &quot;payload&quot;: [1, 2, 3]}
{&quot;response_id&quot;:42,&quot;method&quot;:&quot;success&quot;,&quot;payload&quot;:[{&quot;id&quot;:1,&quot;value&quot;:[0,0,197,8,0,3],&quot;raw&quot;:&quot;AADFCAAD&quot;},{&quot;id&quot;:2,&quot;value&quot;:[16],&quot;raw&quot;:&quot;EA==&quot;},{&quot;id&quot;:3,&quot;value&quot;:[18],&quot;raw&quot;:&quot;Eg==&quot;}]}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:1,&quot;value&quot;:22.9,&quot;raw&quot;:&quot;DHk=&quot;}}
{&quot;method&quot;:&quot;datapoint value&quot;,&quot;payload&quot;:{&quot;id&quot;:1,&quot;value&quot;:23.2,&quot;raw&quot;:&quot;DIg=&quot;}}
</pre></div>
</div>
<p>Thank you for attention.</p>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">bobaos</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hardware-configuration">hardware configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#node-js">Node.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="#redis">Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bobaos-pub">bobaos.pub</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bobaos-tool">bobaos.tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bobaos-sub">bobaos.sub</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bobaos-ws">bobaos.ws</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="intro.html" title="previous chapter">Introduction</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Vladimir Shabunin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="_sources/quickstart.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>